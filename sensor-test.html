<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Testing - Pharma Downtime Monitoring</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .header h1 {
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-link {
            color: #2563eb;
            text-decoration: none;
            margin-top: 10px;
            display: inline-block;
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .sensor-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid #2563eb;
        }

        .sensor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .sensor-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sensor-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-online {
            background: #dcfce7;
            color: #166534;
        }

        .status-offline {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-testing {
            background: #fef3c7;
            color: #d97706;
        }

        .sensor-reading {
            text-align: center;
            margin: 20px 0;
        }

        .reading-value {
            font-size: 3rem;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 5px;
        }

        .reading-unit {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .sensor-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .sensor-log {
            max-height: 200px;
            overflow-y: auto;
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .diagnostics-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .diagnostics-header {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .diagnostic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .diagnostic-label {
            font-weight: 500;
            color: #374151;
        }

        .diagnostic-value {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .value-good {
            background: #dcfce7;
            color: #166534;
        }

        .value-bad {
            background: #fee2e2;
            color: #dc2626;
        }

        .chart-container {
            height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            margin-top: 15px;
        }

        .connection-guide {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .connection-guide h4 {
            color: #92400e;
            margin-bottom: 10px;
        }

        .connection-guide ul {
            color: #92400e;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß Sensor Testing & Diagnostics</h1>
        <a href="dashboard.html" class="nav-link">‚Üê Back to Dashboard</a>
    </div>

    <div class="sensor-grid">
        <!-- Temperature Sensor -->
        <div class="sensor-card">
            <div class="sensor-header">
                <div class="sensor-title">üå°Ô∏è Temperature Sensor</div>
                <div class="sensor-status status-offline" id="temp-status">Offline</div>
            </div>
            
            <div class="sensor-reading">
                <div class="reading-value" id="temp-reading">--</div>
                <div class="reading-unit">¬∞C</div>
            </div>

            <div class="sensor-controls">
                <button class="btn btn-primary" onclick="testSensor('temperature')">Test Sensor</button>
                <button class="btn btn-secondary" onclick="calibrateSensor('temperature')">Calibrate</button>
                <button class="btn btn-danger" onclick="stopSensor('temperature')">Stop</button>
            </div>

            <div class="connection-guide">
                <h4>Connection Check:</h4>
                <ul>
                    <li>VCC ‚Üí 3.3V/5V</li>
                    <li>GND ‚Üí Ground</li>
                    <li>DATA ‚Üí Digital Pin 2</li>
                </ul>
            </div>

            <div class="sensor-log" id="temp-log">
                <div class="log-entry">Sensor initialized...</div>
            </div>
        </div>

        <!-- Vibration Sensor -->
        <div class="sensor-card">
            <div class="sensor-header">
                <div class="sensor-title">üì≥ Vibration Sensor</div>
                <div class="sensor-status status-offline" id="vibration-status">Offline</div>
            </div>
            
            <div class="sensor-reading">
                <div class="reading-value" id="vibration-reading">--</div>
                <div class="reading-unit">Hz</div>
            </div>

            <div class="sensor-controls">
                <button class="btn btn-primary" onclick="testSensor('vibration')">Test Sensor</button>
                <button class="btn btn-secondary" onclick="calibrateSensor('vibration')">Calibrate</button>
                <button class="btn btn-danger" onclick="stopSensor('vibration')">Stop</button>
            </div>

            <div class="connection-guide">
                <h4>Connection Check:</h4>
                <ul>
                    <li>VCC ‚Üí 5V</li>
                    <li>GND ‚Üí Ground</li>
                    <li>OUT ‚Üí Analog Pin A0</li>
                </ul>
            </div>

            <div class="sensor-log" id="vibration-log">
                <div class="log-entry">Sensor initialized...</div>
            </div>
        </div>

        <!-- Pressure Sensor -->
        <div class="sensor-card">
            <div class="sensor-header">
                <div class="sensor-title">üìè Pressure Sensor</div>
                <div class="sensor-status status-offline" id="pressure-status">Offline</div>
            </div>
            
            <div class="sensor-reading">
                <div class="reading-value" id="pressure-reading">--</div>
                <div class="reading-unit">PSI</div>
            </div>

            <div class="sensor-controls">
                <button class="btn btn-primary" onclick="testSensor('pressure')">Test Sensor</button>
                <button class="btn btn-secondary" onclick="calibrateSensor('pressure')">Calibrate</button>
                <button class="btn btn-danger" onclick="stopSensor('pressure')">Stop</button>
            </div>

            <div class="connection-guide">
                <h4>Connection Check:</h4>
                <ul>
                    <li>VCC ‚Üí 5V</li>
                    <li>GND ‚Üí Ground</li>
                    <li>SIG ‚Üí Analog Pin A1</li>
                </ul>
            </div>

            <div class="sensor-log" id="pressure-log">
                <div class="log-entry">Sensor initialized...</div>
            </div>
        </div>

        <!-- Current Sensor -->
        <div class="sensor-card">
            <div class="sensor-header">
                <div class="sensor-title">‚ö° Current Sensor</div>
                <div class="sensor-status status-offline" id="current-status">Offline</div>
            </div>
            
            <div class="sensor-reading">
                <div class="reading-value" id="current-reading">--</div>
                <div class="reading-unit">A</div>
            </div>

            <div class="sensor-controls">
                <button class="btn btn-primary" onclick="testSensor('current')">Test Sensor</button>
                <button class="btn btn-secondary" onclick="calibrateSensor('current')">Calibrate</button>
                <button class="btn btn-danger" onclick="stopSensor('current')">Stop</button>
            </div>

            <div class="connection-guide">
                <h4>Connection Check:</h4>
                <ul>
                    <li>VCC ‚Üí 5V</li>
                    <li>GND ‚Üí Ground</li>
                    <li>OUT ‚Üí Analog Pin A2</li>
                </ul>
            </div>

            <div class="sensor-log" id="current-log">
                <div class="log-entry">Sensor initialized...</div>
            </div>
        </div>
    </div>

    <!-- Diagnostics Section -->
    <div class="diagnostics-section">
        <div class="diagnostics-header">üîç System Diagnostics</div>
        
        <div class="diagnostic-item">
            <div class="diagnostic-label">Arduino Connection</div>
            <div class="diagnostic-value value-bad" id="arduino-connection">Disconnected</div>
        </div>
        
        <div class="diagnostic-item">
            <div class="diagnostic-label">Serial Communication</div>
            <div class="diagnostic-value value-bad" id="serial-communication">Not Available</div>
        </div>
        
        <div class="diagnostic-item">
            <div class="diagnostic-label">Power Supply</div>
            <div class="diagnostic-value value-good" id="power-supply">5V OK</div>
        </div>
        
        <div class="diagnostic-item">
            <div class="diagnostic-label">Data Transmission</div>
            <div class="diagnostic-value value-bad" id="data-transmission">No Data</div>
        </div>

        <div class="sensor-controls" style="margin-top: 20px;">
            <button class="btn btn-primary" onclick="runFullDiagnostic()">Run Full Diagnostic</button>
            <button class="btn btn-secondary" onclick="resetSystem()">Reset System</button>
            <button class="btn btn-secondary" onclick="exportLogs()">Export Logs</button>
        </div>

        <div class="chart-container">
            üìä Real-time sensor data visualization would appear here
        </div>
    </div>

    <script>
        // Sensor testing functionality
        class SensorTester {
            constructor() {
                this.sensors = {
                    temperature: { value: 0, status: 'offline', interval: null },
                    vibration: { value: 0, status: 'offline', interval: null },
                    pressure: { value: 0, status: 'offline', interval: null },
                    current: { value: 0, status: 'offline', interval: null }
                };
                this.init();
            }

            init() {
                this.updateDiagnostics();
                this.checkArduinoConnection();
            }

            testSensor(sensorType) {
                const sensor = this.sensors[sensorType];
                
                if (sensor.status === 'testing') {
                    this.logMessage(sensorType, 'Sensor is already being tested');
                    return;
                }

                sensor.status = 'testing';
                this.updateSensorStatus(sensorType, 'Testing', 'status-testing');
                this.logMessage(sensorType, 'Starting sensor test...');

                // Simulate sensor testing
                let testCount = 0;
                sensor.interval = setInterval(() => {
                    testCount++;
                    
                    // Generate realistic test data
                    let value;
                    switch(sensorType) {
                        case 'temperature':
                            value = (20 + Math.random() * 40).toFixed(1);
                            break;
                        case 'vibration':
                            value = (Math.random() * 50).toFixed(2);
                            break;
                        case 'pressure':
                            value = (10 + Math.random() * 20).toFixed(1);
                            break;
                        case 'current':
                            value = (1 + Math.random() * 5).toFixed(2);
                            break;
                    }

                    sensor.value = value;
                    this.updateSensorReading(sensorType, value);
                    this.logMessage(sensorType, `Reading ${testCount}: ${value}`);

                    if (testCount >= 10) {
                        sensor.status = 'online';
                        this.updateSensorStatus(sensorType, 'Online', 'status-online');
                        this.logMessage(sensorType, 'Sensor test completed successfully');
                        this.updateDiagnostics();
                    }
                }, 500);
            }

            stopSensor(sensorType) {
                const sensor = this.sensors[sensorType];
                
                if (sensor.interval) {
                    clearInterval(sensor.interval);
                    sensor.interval = null;
                }

                sensor.status = 'offline';
                this.updateSensorStatus(sensorType, 'Offline', 'status-offline');
                this.updateSensorReading(sensorType, '--');
                this.logMessage(sensorType, 'Sensor stopped');
                this.updateDiagnostics();
            }

            calibrateSensor(sensorType) {
                this.logMessage(sensorType, 'Starting calibration...');
                
                setTimeout(() => {
                    this.logMessage(sensorType, 'Calibration completed');
                }, 2000);
            }

            updateSensorStatus(sensorType, text, className) {
                const statusElement = document.getElementById(`${sensorType}-status`);
                statusElement.textContent = text;
                statusElement.className = `sensor-status ${className}`;
            }

            updateSensorReading(sensorType, value) {
                const readingElement = document.getElementById(`${sensorType}-reading`);
                readingElement.textContent = value;
            }

            logMessage(sensorType, message) {
                const logElement = document.getElementById(`${sensorType}-log`);
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.textContent = `${timestamp}: ${message}`;
                
                logElement.appendChild(logEntry);
                logElement.scrollTop = logElement.scrollHeight;

                // Keep only last 20 entries
                while (logElement.children.length > 20) {
                    logElement.removeChild(logElement.firstChild);
                }
            }

            checkArduinoConnection() {
                // Simulate checking Arduino connection
                setTimeout(() => {
                    const isConnected = Math.random() > 0.5; // Random for demo
                    
                    const connectionElement = document.getElementById('arduino-connection');
                    const serialElement = document.getElementById('serial-communication');
                    const dataElement = document.getElementById('data-transmission');

                    if (isConnected) {
                        connectionElement.textContent = 'Connected';
                        connectionElement.className = 'diagnostic-value value-good';
                        
                        serialElement.textContent = 'COM3 - 9600 baud';
                        serialElement.className = 'diagnostic-value value-good';
                        
                        dataElement.textContent = 'Receiving';
                        dataElement.className = 'diagnostic-value value-good';
                    }
                }, 2000);
            }

            updateDiagnostics() {
                const onlineSensors = Object.values(this.sensors).filter(s => s.status === 'online').length;
                const dataElement = document.getElementById('data-transmission');
                
                if (onlineSensors > 0) {
                    dataElement.textContent = `${onlineSensors} sensors active`;
                    dataElement.className = 'diagnostic-value value-good';
                }
            }

            runFullDiagnostic() {
                alert('Running full system diagnostic...\n\n' +
                      '‚úì Checking hardware connections\n' +
                      '‚úì Testing sensor responses\n' +
                      '‚úì Validating data integrity\n' +
                      '‚úì Verifying communication protocols\n\n' +
                      'Diagnostic complete!');
            }

            resetSystem() {
                Object.keys(this.sensors).forEach(sensorType => {
                    this.stopSensor(sensorType);
                });
                
                // Reset logs
                Object.keys(this.sensors).forEach(sensorType => {
                    const logElement = document.getElementById(`${sensorType}-log`);
                    logElement.innerHTML = '<div class="log-entry">System reset - sensor reinitialized...</div>';
                });

                alert('System reset complete!');
            }

            exportLogs() {
                let logData = 'Sensor Test Logs Export\n';
                logData += '========================\n\n';

                Object.keys(this.sensors).forEach(sensorType => {
                    logData += `${sensorType.toUpperCase()} SENSOR:\n`;
                    const logElement = document.getElementById(`${sensorType}-log`);
                    Array.from(logElement.children).forEach(entry => {
                        logData += entry.textContent + '\n';
                    });
                    logData += '\n';
                });

                const blob = new Blob([logData], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'sensor_test_logs.txt';
                a.click();
                window.URL.revokeObjectURL(url);
            }
        }

        // Global functions for button clicks
        let sensorTester;

        document.addEventListener('DOMContentLoaded', () => {
            sensorTester = new SensorTester();
        });

        function testSensor(type) {
            sensorTester.testSensor(type);
        }

        function stopSensor(type) {
            sensorTester.stopSensor(type);
        }

        function calibrateSensor(type) {
            sensorTester.calibrateSensor(type);
        }

        function runFullDiagnostic() {
            sensorTester.runFullDiagnostic();
        }

        function resetSystem() {
            sensorTester.resetSystem();
        }

        function exportLogs() {
            sensorTester.exportLogs();
        }
    </script>
</body>
</html>
